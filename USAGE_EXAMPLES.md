# Confluence MCP 使用示例

本文档展示如何在 Cursor 中通过自然语言使用 Confluence MCP Server。

## 📋 基础操作

### 1. 查看可用的 Spaces

**你的提问：**
```
列出我可以访问的所有 Confluence Spaces
```

**AI 会做什么：**
- 调用 `confluence_list_spaces` 工具
- 返回所有可访问的 Spaces 列表

**预期结果：**
```json
[
  {
    "key": "TECH",
    "name": "技术文档",
    "type": "global"
  },
  {
    "key": "PRODUCT",
    "name": "产品文档",
    "type": "global"
  }
]
```

---

### 2. 创建新页面（使用模板）

**你的提问：**
```
在 Confluence 创建一个技术设计文档，标题是"用户认证系统设计"，使用 tech-design 模板
```

**AI 会做什么：**
- 调用 `confluence_create_page` 工具
- 使用 `tech-design` 模板创建页面
- 标题设置为"用户认证系统设计"

**预期结果：**
```
✅ 页面创建成功！

ID: 123456789
标题: 用户认证系统设计
URL: https://your-instance.atlassian.net/wiki/spaces/TECH/pages/123456789
```

---

### 3. 创建会议纪要

**你的提问：**
```
帮我创建一个会议纪要，标题是"2024年度技术规划会议"，使用 meeting-notes 模板
```

**AI 会做什么：**
- 使用 `meeting-notes` 模板
- 创建标准格式的会议纪要页面

---

### 4. 创建自定义内容的页面

**你的提问：**
```
在 Confluence 创建一个页面，标题是"API 接口文档"，内容包括：
- 用户登录接口 POST /api/login
- 用户注册接口 POST /api/register
- 获取用户信息 GET /api/user/:id
```

**AI 会做什么：**
- 将你的内容转换为 Confluence Storage Format (HTML)
- 创建包含这些内容的页面

---

## 🔍 搜索和查询

### 5. 搜索页面

**你的提问：**
```
搜索所有包含"API"的 Confluence 页面
```

**AI 会做什么：**
- 调用 `confluence_search_pages` 工具
- 搜索标题包含"API"的页面

---

### 6. 在特定 Space 中搜索

**你的提问：**
```
在 TECH Space 中搜索所有关于"认证"的文档
```

**AI 会做什么：**
- 使用 space 参数限制搜索范围
- 返回 TECH Space 中相关的页面

---

### 7. 获取页面详细信息

**你的提问：**
```
获取"用户认证系统设计"这个页面的详细信息
```

**AI 会做什么：**
- 调用 `confluence_get_page` 工具
- 返回页面的完整信息，包括内容、版本号、URL 等

---

### 8. 查看子页面

**你的提问：**
```
查看页面 ID 123456789 下的所有子页面
```

**AI 会做什么：**
- 调用 `confluence_get_child_pages` 工具
- 返回该页面的所有子页面列表

---

## ✏️ 更新操作

### 9. 更新页面内容

**你的提问：**
```
更新"用户认证系统设计"文档，在技术方案部分添加以下内容：

## 密码加密方案
- 使用 bcrypt 算法
- Salt rounds: 10
- 存储加密后的哈希值
```

**AI 会做什么：**
1. 先获取现有页面内容
2. 在适当位置插入新内容
3. 调用 `confluence_update_page` 更新页面

---

### 10. 修改页面标题

**你的提问：**
```
把"用户认证系统设计"页面的标题改为"用户认证与授权系统设计"
```

**AI 会做什么：**
- 使用 `newTitle` 参数更新页面标题

---

### 11. 使用新模板更新页面

**你的提问：**
```
用 code-review 模板更新页面 ID 123456789
```

**AI 会做什么：**
- 加载 `code-review` 模板
- 替换页面内容为模板内容

---

## 📝 模板管理

### 12. 查看所有可用模板

**你的提问：**
```
列出所有可用的 Confluence 页面模板
```

**预期结果：**
```json
[
  {
    "name": "template",
    "path": "/path/to/templates/template.html"
  },
  {
    "name": "meeting-notes",
    "path": "/path/to/templates/meeting-notes.html"
  },
  {
    "name": "tech-design",
    "path": "/path/to/templates/tech-design.html"
  },
  {
    "name": "code-review",
    "path": "/path/to/templates/code-review.html"
  }
]
```

---

### 13. 查看模板内容

**你的提问：**
```
显示 tech-design 模板的内容
```

**AI 会做什么：**
- 调用 `confluence_load_template` 工具
- 返回模板的 HTML 内容

---

### 14. 创建新模板

**你的提问：**
```
创建一个新的项目立项模板，包括：
- 项目背景
- 项目目标
- 预期收益
- 资源需求
- 风险评估
```

**AI 会做什么：**
1. 根据你的要求生成模板 HTML
2. 调用 `confluence_save_template` 保存模板
3. 模板名称如 "project-proposal"

---

## 🎯 高级用法

### 15. 创建带层级的页面

**你的提问：**
```
在"技术文档"页面（ID: 123456）下创建一个子页面，标题是"API 版本 2.0"
```

**AI 会做什么：**
- 使用 `parentId` 参数创建子页面

---

### 16. 批量操作

**你的提问：**
```
帮我创建以下三个技术文档：
1. 数据库设计文档
2. 缓存架构设计
3. 消息队列设计

都放在 TECH Space 中，使用 tech-design 模板
```

**AI 会做什么：**
- 循环调用 `confluence_create_page` 三次
- 每次使用相同的模板
- 创建三个独立的页面

---

### 17. 智能更新（upsert）

**你的提问：**
```
创建或更新"每周技术分享"页面，添加本周的分享内容
```

**AI 会做什么：**
- 调用 `confluence_upsert_page` 工具
- 如果页面存在则更新，不存在则创建

---

### 18. 查看页面历史

**你的提问：**
```
查看"用户认证系统设计"的最近 5 次修改历史
```

**AI 会做什么：**
- 先获取页面 ID
- 调用 `confluence_get_page_history` 工具
- 返回版本历史信息

---

### 19. 复杂内容创建

**你的提问：**
```
创建一个技术评审文档，包括：
- 评审的代码模块列表
- 每个模块的评分表格
- 问题追踪表
- 总体评价

使用 code-review 模板，标题是"用户服务模块代码评审"
```

**AI 会做什么：**
1. 加载 code-review 模板
2. 根据你的需求填充内容
3. 创建格式良好的评审文档

---

### 20. 跨 Space 操作

**你的提问：**
```
在 PRODUCT Space 创建一个页面，在 TECH Space 创建对应的技术实现文档，两者互相引用
```

**AI 会做什么：**
1. 在 PRODUCT Space 创建页面
2. 在 TECH Space 创建技术文档
3. 在两个页面中添加互相的链接

---

## 🗑️ 删除操作

### 21. 删除页面

**你的提问：**
```
删除页面 ID 为 123456789 的页面
```

**AI 会做什么：**
- 调用 `confluence_delete_page` 工具
- 删除指定页面

⚠️ **注意：** 删除操作不可恢复，请谨慎使用！

---

## 💡 实用场景

### 场景 1：周报自动化

**你的提问：**
```
创建本周的技术周报，标题是"技术周报 2024-12-16"，包括：
- 本周完成的功能
- 遇到的技术难点
- 下周计划
```

---

### 场景 2：代码评审记录

**你的提问：**
```
为 PR #1234 创建代码评审文档，评审范围是用户认证模块，
记录以下问题：
1. 密码强度验证不够严格
2. 缺少错误处理
3. 需要添加单元测试
```

---

### 场景 3：技术方案对比

**你的提问：**
```
创建一个技术方案对比文档，对比 Redis 和 Memcached 作为缓存方案的优缺点
```

---

### 场景 4：API 文档维护

**你的提问：**
```
更新"API 文档"页面，添加新的用户管理接口：
POST /api/users - 创建用户
PUT /api/users/:id - 更新用户
DELETE /api/users/:id - 删除用户
```

---

## 📌 最佳实践

### 提问技巧

1. **明确指定操作类型**
   - ✅ "创建一个页面..."
   - ✅ "更新页面..."
   - ✅ "搜索包含...的页面"

2. **提供必要信息**
   - 页面标题
   - Space Key（如果不使用默认）
   - 模板名称（如果需要）

3. **描述清晰的内容结构**
   - 使用列表
   - 使用标题层级
   - 提供示例数据

4. **利用模板**
   - 优先使用预置模板
   - 需要时可以请求创建新模板

### 常见问题

**Q: 如何知道页面的 ID？**
A: 先搜索页面，或者获取页面信息，返回结果中会包含 ID。

**Q: 可以同时在多个 Space 操作吗？**
A: 可以，在每次操作时指定不同的 Space Key。

**Q: 模板可以包含变量吗？**
A: 模板是静态 HTML，但你可以在创建页面时让 AI 填充具体内容。

**Q: 如何创建表格？**
A: 在提问中描述表格结构，AI 会转换为 Confluence 的表格 HTML。

---

## 🎓 进阶技巧

### 1. 使用上下文

如果你在一次对话中多次操作同一个页面，AI 会记住上下文：

```
你: 创建一个技术文档，标题是"缓存系统设计"
AI: [创建页面]

你: 在这个文档中添加 Redis 的配置说明
AI: [会自动更新刚才创建的页面]
```

### 2. 批量导入

```
帮我把以下文档都导入到 Confluence：
- docs/api.md -> API 接口文档
- docs/database.md -> 数据库设计
- docs/deployment.md -> 部署指南
```

### 3. 模板组合

```
创建一个页面，前半部分使用 meeting-notes 模板，
后半部分添加技术方案的表格
```

---

## 🔗 相关资源

- [快速开始指南](./QUICKSTART.md)
- [MCP 完整文档](./MCP_README.md)
- [Confluence Storage Format 文档](https://confluence.atlassian.com/doc/confluence-storage-format-790796544.html)

---

**提示：** 这些只是示例，你可以用自然语言表达任何需求，AI 会理解并调用合适的工具完成任务！
